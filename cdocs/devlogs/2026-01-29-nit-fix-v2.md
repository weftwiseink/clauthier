---
first_authored:
  by: "@claude-opus-4-5-20251101"
  at: 2026-01-29T16:30:00-08:00
task_list: cdocs/nit-fix-v2
type: devlog
state: live
status: wip
tags: [claude_skills, writing_conventions, subagent_patterns, proposal_authoring]
---

# Nit Fix v2 Proposal: Devlog

## Objective

Rework the nit-fix skill proposal to align with the v2 agent architecture established in `cdocs/proposals/2026-01-29-triage-v2-agents-and-automation.md`.
The v1 proposal used the old pattern (skill containing a prompt template for a Task subagent).
The v2 architecture uses formal agent definitions in `plugins/cdocs/agents/` with tool allowlists, skills preloading, and read-at-runtime rules.

The core design constraint remains: the nit-fix agent must not hardcode rules.
It reads rule files from `rules/` at runtime and enforces whatever conventions it finds.

Extended scope (session 2): evolve the proposal toward multi-rule loading, integrate the mermaid diagrams rule proposal, and create RFPs for project-configured rules and a mermaid plugin.

## Plan

1. Read the triage-v2 proposal and implemented agents (triage.md, reviewer.md) as architectural reference.
2. Mark the v1 nit-fix proposal as `evolved`.
3. Write the new v2 proposal following the agent + thin dispatcher pattern.
4. Exercise the cdocs subagent flows: triage and review on the new proposal.

## Testing Approach

Proposal authoring session.
Verification is exercising the triage and review flows on the finished proposal.

## Implementation Notes

### Key architectural differences from v1

- v1: skill containing an inline prompt template, agent spawned via Task tool with `model: "haiku"`.
- v2: formal agent definition in `agents/nit-fix.md` with `model: haiku`, `tools: Read, Glob, Grep, Edit`, and the agent prompt as the markdown body. Skill becomes a thin dispatcher.

### Read-at-runtime pattern

The triage agent reads `frontmatter-spec.md` at startup.
The nit-fix agent reads `writing-conventions.md` at startup.
Same pattern, different rules file.
This is the mechanism that makes nit-fix a "rules stickler" without hardcoding.

### Multi-rule evolution

The initial v2 proposal read a single rule file (`writing-conventions.md`).
After the mermaid diagrams rule proposal demonstrated the value of standalone modular rules, the design was extended to glob `plugins/cdocs/rules/*.md` at startup and aggregate conventions from all discovered files.
This is the foundation for future extensibility: project-configured rules and cross-plugin rule contributions.

### Parallel subagent authoring

Three documents were authored in parallel by sonnet subagents:
1. Mermaid diagrams rule proposal (`cdocs/proposals/2026-01-30-use-mermaid-diagrams.md`)
2. Project-configured rules RFP (`cdocs/proposals/2026-01-30-nit-fix-project-rules.md`)
3. Mermaid plugin RFP (`cdocs/proposals/2026-01-30-mermaid-plugin.md`)

## Changes Made

| File | Description |
|------|-------------|
| `cdocs/proposals/2026-01-29-nit-fix-skill.md` | Marked as `evolved`, superseded by v2 |
| `cdocs/proposals/2026-01-29-nit-fix-agent.md` | New v2 proposal using formal agent architecture |
| `cdocs/reviews/2026-01-29-review-of-nit-fix-agent.md` | Round 1 review (sonnet): verdict revise, 6 blocking items |
| `cdocs/reviews/2026-01-29-review-of-nit-fix-agent-r2.md` | Round 2 review (sonnet): verdict accept, 3 non-blocking items |
| `cdocs/reviews/2026-01-30-review-of-nit-fix-agent-r3.md` | Round 3 review (sonnet): verdict accept, multi-rule changes approved |
| `cdocs/proposals/2026-01-30-use-mermaid-diagrams.md` | Standalone mermaid diagrams rule proposal (sonnet subagent) |
| `cdocs/proposals/2026-01-30-nit-fix-project-rules.md` | RFP: extend nit-fix to project-configured rules (sonnet subagent) |
| `cdocs/proposals/2026-01-30-mermaid-plugin.md` | RFP: mermaid plugin wrapping documentation-skill + beautiful-mermaid (sonnet subagent) |
| `cdocs/devlogs/2026-01-29-nit-fix-v2.md` | This devlog |

## Verification

### Triage and review flow exercised

Exercised the full cdocs subagent workflow on the nit-fix v2 proposal:

1. **Triage (round 1)**: triaged 3 files (proposal, devlog, evolved v1 proposal). No mechanical fixes needed on proposal. Recommended `[REVIEW]` for the proposal.
2. **Review (round 1)**: sonnet reviewer identified 6 blocking issues (no Phase 0 validation, classification mechanism underspecified, no agent body, protected zone logic missing, sentence-splitting logic missing, test cases lack expected behavior). Verdict: Revise.
3. **Revision**: addressed all 6 blocking + 4 non-blocking items. Added Phase 0, classification heuristic with fallback, Appendix A (full agent body), protected zone detection logic, sentence boundary rules, expanded test cases.
4. **Re-triage**: no fixes needed, recommended `[REVIEW]` (re-review).
5. **Review (round 2)**: all blocking items resolved. 3 non-blocking suggestions (abbreviation list placement, batch mode performance, integration with end-of-turn workflow). Verdict: **Accept**.
6. **Status update**: proposal status set to `implementation_ready`.

### Session 2: multi-rule evolution

7. **Parallel subagent authoring**: dispatched 3 sonnet subagents in parallel to write the mermaid diagrams rule proposal, project-configured rules RFP, and mermaid plugin RFP.
8. **Multi-rule integration**: updated the nit-fix proposal to glob `rules/*.md` at startup (Decision 6, updated BLUF, Objective, Appendix A, Story 2b).
9. **Review (round 3)**: sonnet reviewer accepted multi-rule changes. 4 non-blocking clarifications about rule file format parsing (resolvable during Phase 1 implementation).
10. **Status update**: proposal returned to `implementation_ready`.

### Downstream documents produced

- `cdocs/proposals/2026-01-30-use-mermaid-diagrams.md` (`review_ready`): standalone mermaid rule file proposal with detection heuristics and explicit judgment-required classification.
- `cdocs/proposals/2026-01-30-nit-fix-project-rules.md` (`request_for_proposal`): RFP for extending nit-fix to read project-local and cross-plugin rules with parallel evaluation and conflict resolution. 8 open questions.
- `cdocs/proposals/2026-01-30-mermaid-plugin.md` (`request_for_proposal`): RFP for a marketplace plugin wrapping `claude-code-documentation-skill` and `beautiful-mermaid` for diagram generation/cleanup. 8 open questions.

> NOTE(mjr/cdocs/nit-fix-v2): Plugin agents (`cdocs:triage`, `cdocs:reviewer`) are not yet available as Task subagent types in this environment.
> Triage and review flows were simulated using `general-purpose` agents with the appropriate model (haiku/sonnet) and the agent prompt instructions from `agents/triage.md` and `agents/reviewer.md`.
> Once the plugin marketplace is fully active, these flows will use the formal agent dispatch (`subagent_type: "triage"` / `subagent_type: "reviewer"`).
